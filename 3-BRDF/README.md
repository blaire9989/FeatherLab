### BRDF Generation Pipeline
This directory contains a collection of $\texttt{MATLAB}$ functions, $\texttt{MATLAB}$ scripts, and stored data used for processing and compressing our simulation results, to be used for rendering.

Among the functions / scripts in this directory, we have introduced the $\texttt{viewPattern.m}$ function in our previous tutorial. This function serves to help us visualize some example 1D scattering patterns that come from our 2.5D simulations.

The other $\texttt{MATLAB}$ functions and scripts serve to process and compress the BRDF parameters computed from wave simulations, assuming that the user has run all the $20 \times 20 \times 50$ sets of simulations for complete characterization of a type of barbule, as described in the previous tutorial. Upon finishing all these simulations, the user can first move the $\texttt{dataX}$ ($X = 1, 2, 3, 4, 5, 6, 7$) into the current $\texttt{3-BRDF}$ directory.

The function $\texttt{constructMaterial.m}$ processes all the output BRDF parameters corresponding to each wavelength and incident direction, and reformats these parameter data into a more compact table that can be easily loaded into a modern renderer. After running this function, the 20000 individual output parameter files are removed and replaced with the file $\texttt{parameters.binary}$ in the $\texttt{render}$ sub-directory of the simulated barbule folder. In fact, we designed our program such that each set of simulations can be run separately on different machines, at the cost of generating a huge number of output files, while $\texttt{constructMaterial.m}$ postprocesses these files, merges them, and also computes coefficients needed for bicubically interpolating these BRDF parameters, which are also stored in $\texttt{parameters.binary}$.

Moreover, the function $\texttt{constructMaterial.m}$ also generates 10000 instances of 1D noise functions used for synthesizing new BRDF instances with the correct statistics, based on the data in $\texttt{noise.binary}$ in the $\texttt{render}$ sub-directory. The function $\texttt{constructMaterial.m}$ then overwrites $\texttt{noise.binary}$ with a new version that contains our generated 1D noise functions (10000 instances). The new $\texttt{noise.binary}$ will also be loaded into a renderer and the noise functions will be queried at render time. The current version of $\texttt{data1}-\texttt{data7}$ folders in our $\texttt{2-FastSim}$ directory contains the $\texttt{parameters.binary}$ and $\texttt{noise.binary}$ files resulting from simulations on all types of barbules.

The function $\texttt{visualizeBRDF.m}$ generates a collection of full hemisphere BRDF plots that describe scattering from different types of barbules, when these barbules are illuminated from different incident directions. Some BRDF lobes are smooth, representing the average scattering functions from distributions of similar barbules, while other BRDFs describe scattering from single barbule instances, and these individual BRDFs corresponding to different barbules are often entirely different in their details. Our repository contains some example BRDF images for all types of barbules, stored in the $\texttt{visual}$ sub-directory of each barbule folder, in the $\texttt{data1}-\texttt{data7}$ folders in our $\texttt{2-FastSim}$ directory.

For convenience, please see our $\texttt{MATLAB}$ script $\texttt{iridescence.m}$ for example usage of $\texttt{constructMaterial.m}$ and $\texttt{visualizeBRDF.m}$.
